import{r as s,j as e,a as f}from"./index-g8GziE3t.js";import{A as v,a as w}from"./AdminSidebar-DtemeWQs.js";import"./ess-121-DfLSNCpt.js";import"./index-DmNBRChd.js";const S="http://localhost:3000",F=({editcategory:r,fetchCategory:y})=>{const[i,n]=s.useState(""),[m,g]=s.useState(null),[l,h]=s.useState(null),[u,b]=s.useState(!1),[x,o]=s.useState("");s.useEffect(()=>{r&&(n(r.categoryName),h(r.image))},[r]);const p=async d=>{if(d.preventDefault(),!i){alert("Please fill all fields");return}const a=new FormData;a.append("categoryName",i),m&&a.append("category",m),a.append("categorId",r._id);try{b(!0);const t=await f.post(`${S}/category/updateCategory`,a,{headers:{"Content-Type":"multipart/form-data"}});if(t.data.success){alert("Category edited successfully!"),y();const c=document.querySelector("[data-bs-dismiss='modal']");c&&c.click(),n(""),g(null),h(null),o("")}else o(t.data.message||"Failed to update category. Please try again.")}catch(t){console.error("Error updating category:",t),o("Failed to update category. Please try again.")}finally{b(!1)}},j=d=>{const a=d.target.files[0];if(a){if(a.size>5e6){alert("File is too large. Please choose a file less than 5MB.");return}if(!a.type.startsWith("image/")){alert("Please select an image file.");return}l&&typeof l=="string"&&URL.revokeObjectURL(l),g(a);const t=URL.createObjectURL(a);h(t)}};return s.useEffect(()=>()=>{l&&typeof l=="string"&&URL.revokeObjectURL(l)},[l]),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",children:"Edit Category"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:p,encType:"multipart/form-data",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category-name",className:"col-form-label",children:"Category Name:"}),e.jsx("input",{type:"text",className:"form-control",value:i,onChange:d=>n(d.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"file-upload",className:"col-form-label",children:"Category Image:"}),e.jsx("label",{htmlFor:"file-upload",className:"btn d-inline-block border border-orange d-flex justify-content-start align-items-center",children:"Category Image"}),e.jsx("input",{type:"file",id:"file-upload",onChange:j,accept:"image/*"}),l&&e.jsx("img",{src:l,alt:"Preview",width:"100"})]}),x&&e.jsx("div",{className:"alert alert-danger",children:x}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:u,children:u?"Updating...":"Update Category"})]})]})})]})},N="http://localhost:3000",L=()=>{const[r,y]=s.useState(""),[i,n]=s.useState(null),[m,g]=s.useState(null),[l,h]=s.useState([]),[u,b]=s.useState({}),x=async a=>{if(a.preventDefault(),!r||!i){alert("Please fill all fields");return}const t=new FormData;t.append("categoryName",r),t.append("category",i);try{const c=await f.post(`${N}/category/addCategory`,t,{headers:{"Content-Type":"multipart/form-data"}});alert("Category added successfully"),o();const C=document.querySelector("[data-bs-dismiss='modal']");C&&C.click(),y(""),n(null),g(null)}catch{alert("Failed to add category. Check console for more details.")}},o=async()=>{try{const a=await f.get(`${N}/category/getAllCategory`);h(a.data.category.sort((t,c)=>t.categoryName.localeCompare(c.categoryName)))}catch(a){console.error("Error fetching categories:",a)}};s.useEffect(()=>{o()},[]);const p=async a=>{if(window.confirm("Are you sure you want to delete this category?"))try{await f.delete(`${N}/category/deleteCategory`,{headers:{"Content-Type":"application/json"},data:{categoryId:a}}),alert("Category deleted successfully"),o()}catch{alert("Failed to delete category. Check console for more details.")}},j=a=>{b(a)},d=a=>{const t=a.target.files[0];t&&t.type.startsWith("image/")?(n(t),g(URL.createObjectURL(t))):alert("Please select a valid image file.")};return e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsx(w,{}),e.jsx("section",{className:"mt-32",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("h4",{children:"Manage Category"}),e.jsx("button",{className:"btn bg-blue text-white","data-bs-toggle":"modal","data-bs-target":"#exampleModalE",children:"Add Category"})]}),e.jsx("div",{className:"modal fade",id:"exampleModalE",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",id:"exampleModalLabel",children:"Add Category"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:x,encType:"multipart/form-data",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category-name",className:"col-form-label",children:"Category Name:"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Category Name",value:r,onChange:a=>y(a.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category-img",className:"col-form-label",children:"Category Image:"}),e.jsx("label",{htmlFor:"file-upload",className:"btn d-inline-block border border-orange d-flex justify-content-start align-items-center",children:"Category Image"}),e.jsx("input",{type:"file",id:"file-upload",name:"categoryImg",onChange:d}),m&&e.jsx("img",{src:m,alt:"Preview",width:"100"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Add"})]})]})})]})})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table text-capitalize table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr No"}),e.jsx("th",{children:"Category Name"}),e.jsx("th",{children:"Category Image"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:l.map((a,t)=>e.jsxs("tr",{className:"text-capitalize",children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:a.categoryName}),e.jsx("td",{children:e.jsx("img",{src:a.image,alt:"Category",width:70})}),e.jsxs("td",{className:"d-flex gap-2 justify-content-center",children:[e.jsx("button",{className:"btn bg-green text-white",onClick:()=>j(a),"data-bs-toggle":"modal","data-bs-target":"#exampleModal",children:"Edit"}),e.jsx("button",{className:"btn bg-orange text-white ms-2",onClick:()=>p(a._id),children:"Delete"})]})]},a._id))})]})}),e.jsx("div",{className:"modal fade",id:"exampleModal",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsx(F,{editcategory:u,fetchCategory:o})})})]})})})})})]})};export{L as default};
