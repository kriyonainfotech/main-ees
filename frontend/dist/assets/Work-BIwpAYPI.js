import{r as n,j as s,a as y,u as U,L as N,B as i}from"./index-g8GziE3t.js";import{A as J}from"./AdminNavbar-BqDe4lKh.js";import{b as O,a as z,U as D}from"./UserSideBar-DC-s98j9.js";import{a as L,S as T}from"./Senedrequest-BIF76En0.js";import{a as W}from"./index-DmNBRChd.js";import{P as M}from"./ProfileSidebar-BIv84Ts5.js";import"./ess-121-DfLSNCpt.js";import"./index-CTpsVrPL.js";const V="http://localhost:3000",Y=({serviceProviderId:o})=>{const h=JSON.parse(localStorage.getItem("token"));if(!h)return alert("You are not logged in!"),null;const[m,x]=n.useState(()=>{const a=localStorage.getItem("providerRating");return a?JSON.parse(a):0}),[r,u]=n.useState(()=>localStorage.getItem("comment")||""),[g,l]=n.useState(!1),f=a=>{x(a),localStorage.setItem("providerRating",JSON.stringify(a))},b=(a,e=5,t)=>Array.from({length:e},(j,d)=>s.jsx(W,{className:`${d+1<=a?"text-warning":""}`,onClick:()=>t(d+1),style:{cursor:"pointer"}},d+1)),p=async a=>{var e;if(a.preventDefault(),!m){alert("Please provide a rating before submitting.");return}l(!0);try{(await y.post(`${V}/user/rate`,{serviceProviderId:o,rating:m,comment:r},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}})).status===200?(localStorage.removeItem("providerRating"),localStorage.removeItem("comment"),x(0),u(""),alert("Rating submitted successfully.")):alert("Failed to submit rating. Please try again.")}catch(t){console.error("Error submitting rating:",((e=t.response)==null?void 0:e.data)||t.message),alert("An error occurred while submitting your rating.")}finally{l(!1)}};return n.useEffect(()=>{localStorage.setItem("comment",r)},[r]),s.jsx("div",{className:"modal fade",id:"exampleModal",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:s.jsx("div",{className:"modal-dialog",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h1",{className:"modal-title fs-5",id:"exampleModalLabel",children:["Rate User ",o]}),s.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),s.jsx("div",{className:"modal-body",children:s.jsxs("form",{onSubmit:p,children:[s.jsx("div",{className:"rating rating-sm py-3 w-full text-center d-flex align-items-center justify-content-center fs-2",children:b(m,5,f)}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-md fs-4 p-2 text-bold",children:"Comment"}),s.jsx("input",{type:"text",value:r,onChange:a=>u(a.target.value),className:"w-100 p-2 rounded border",placeholder:"Write your comment here...",required:!0})]}),s.jsx("div",{className:"modal-footer",children:s.jsx("button",{type:"submit",className:"btn btn-primary",disabled:g,children:g?"Submitting...":"Submit"})})]})})]})})})},S="http://localhost:3000",G=({recievedRequest:o,isReceiverAvailable:h,setIsReceiverAvailable:m})=>{const[x,r]=n.useState(""),[u,g]=n.useState(""),l=JSON.parse(localStorage.getItem("token"));U(),n.useState(()=>{const e=localStorage.getItem("providerRating");return e?JSON.parse(e):0});const f=(e,t=5)=>{const j=e.length>0?e.reduce((c,w)=>c+w.rating,0)/e.length:0,d=[];for(let c=1;c<=t;c++)d.push(s.jsx(z,{className:` ${c<=j?"text-warning":""}`,style:{cursor:"pointer"}},c));return d},b=async e=>{try{const t=await y.post(`${S}/request/receivedRequest`,{senderId:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});t.status===200?(r("received"),i.success("Request accepted successfully")):(console.error("Failed to accept request:",t.data.message),i.error("Failed to accept request."))}catch(t){console.error("Error accepting user request:",t),i.error("An error occurred while accepting the request.")}},p=async e=>{try{const t=await y.post(`${S}/request/cancelRequest`,{senderId:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});t.status===200?(r("canceled"),i.success("Request canceled successfully.")):(console.error("Failed to cancel request:",t.data.message),i.error("Failed to cancel request."))}catch(t){console.error("Error canceling user request:",t),i.error("An error occurred while canceling the request.")}};n.useEffect(()=>{[...o].forEach(t=>{t.status==="received"?r("received"):t.status==="canceled"?r("canceled"):t.status==="pending"&&r("pending")})},[o]);const a=async e=>{try{const t=await y.post(`${S}/request/workDone`,{senderId:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});t.status===200?(r("pending"),i.success("Work done successfully")):(console.error("Failed to work done request:",t.data.message),i.error("Failed to work done request."))}catch(t){console.error("Error work done  user request:",t),i.error("An error occurred while work done  request.")}g(e)};return s.jsx("section",{children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-12 pt-3",children:s.jsx("h4",{children:"Received Request"})}),s.jsx("div",{className:"col-12 flex flex-wrap py-2 ",children:o.map((e,t)=>{var j,d,c,w,R,q,k,A,C,$,I,v,F,P,E,_,B;return s.jsx("div",{className:"col-12 col-md-6 w-full col-lg-4 p-1",children:s.jsxs("div",{className:"bg-white border-black rounded-md overflow-hidden d-flex shadow flex-md-column",style:{position:"relative"},children:[s.jsxs("div",{className:"col-5 col-md-12 d-flex",children:[s.jsx("div",{className:"img p-2",style:{height:"300px",width:"100%"},children:s.jsx("img",{className:"img-fluid rounded",src:((j=e==null?void 0:e.user)==null?void 0:j.profilePic)||"https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/User_icon_2.svg/220px-User_icon_2.svg.png",alt:"User",style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top"}})}),s.jsx("span",{className:`position-absolute rounded-full top-5 end-5 p-1 text-sm text-white px-2 ${((d=e==null?void 0:e.user)==null?void 0:d.userstatus)==="available"?"bg-green":"bg-orange"}`,children:(c=e==null?void 0:e.user)==null?void 0:c.userstatus})]}),s.jsx("div",{className:"p-3 pt-0 col-7 col-md-12 d-flex align-items-center",children:s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-start justify-content-md-between",children:[s.jsxs("div",{className:"rating  rating-sm py-3 w-full text-center d-flex align-items-center",children:[f(((w=e==null?void 0:e.user)==null?void 0:w.ratings)||[],10),s.jsx("span",{className:" ms-2 p-0 px-3 ",children:(q=(R=e==null?void 0:e.user)==null?void 0:R.ratings)!=null&&q.length?(k=e==null?void 0:e.user)==null?void 0:k.ratings[0].rating:0})]}),s.jsxs("h6",{className:"d-flex align-items-center text-orange m-0 text-sm w-100 justify-content-start justify-content-md-end",children:[s.jsx("img",{src:L,width:40,alt:""})," ",e.user.businessCategory]})]}),s.jsx("h4",{className:"",children:e.user.name}),s.jsxs("p",{className:"d-flex align-items-center gap-2 text",children:[s.jsx(O,{})," ",(C=(A=e==null?void 0:e.user)==null?void 0:A.address)==null?void 0:C.area," ",(I=($=e==null?void 0:e.user)==null?void 0:$.address)==null?void 0:I.city," ",(F=(v=e==null?void 0:e.user)==null?void 0:v.address)==null?void 0:F.state," ",(E=(P=e==null?void 0:e.user)==null?void 0:P.address)==null?void 0:E.country," ",(B=(_=e==null?void 0:e.user)==null?void 0:_.address)==null?void 0:B.pincode]}),s.jsxs("div",{className:"pt-2 d-flex flex-column flex-md-row gap-3 justify-content-between align-items-start w-100",children:[e.status==="received"?s.jsx(N,{to:`tel:${e.user.phone}`,className:"btn pt-2 w-50 border-green rounded-1 text-semibold text-green btn-outline-orange",children:"Contact Now"}):s.jsx(N,{onClick:()=>b(e.user._id),className:"btn pt-2 w-50 border-orange rounded-1 text-semibold text-orange btn-outline-orange",children:"Accept"}),e.status==="received"?s.jsx(N,{onClick:()=>a(e.user._id),className:"btn pt-2 w-50 border-green rounded-1 text-semibold text-green btn-outline-orange","data-bs-toggle":"modal","data-bs-target":"#exampleModal",children:"Work Done"}):s.jsx(N,{onClick:()=>p(e.user._id),className:"btn pt-2 w-50 border-orange rounded-1 text-semibold text-orange btn-outline-orange",children:"Cancel"})]}),s.jsx(Y,{serviceProviderId:u})]})})]})},t)})})]})})})},H="http://localhost:3000",re=()=>{const o=JSON.parse(localStorage.getItem("token")),[h,m]=n.useState([]),[x,r]=n.useState([]),[u,g]=n.useState("Received Request"),[l,f]=n.useState(!0),b=[{id:1,name:"Sended Request"},{id:2,name:"Received Request"}],p=n.useCallback(async()=>{try{const a=await y.get(`${H}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(a.status===200){const{receivedRequests:e,sendedRequests:t}=a.data;m(e||[]),r(t||[])}else console.error("Failed to fetch requests:",a.data.message)}catch(a){console.error("Error fetching user requests:",a),alert("Failed to fetch user requests. Please try again.")}},[o]);return n.useEffect(()=>{p()},[p]),s.jsxs(s.Fragment,{children:[s.jsx(J,{}),s.jsx(D,{}),s.jsx(M,{}),s.jsxs("div",{className:"my-32",children:[s.jsx("section",{children:s.jsx("div",{className:"container",children:s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-12 d-flex gap-3",children:b.map(a=>s.jsx("div",{className:"receivReqBtn",children:s.jsx(N,{className:`btn rounded-0 text-white ${u===a.name?"btn-success":"bg-green-100"}`,onClick:()=>g(a.name),children:a.name})},a.id))})})})}),s.jsx("div",{className:"mt-4",children:u==="Received Request"?s.jsx(G,{recievedRequest:h,isReceiverAvailable:l,setIsReceiverAvailable:f}):s.jsx(T,{sendedRequest:x,setSendedRequest:r,isReceiverAvailable:l})})]})]})};export{re as default};
