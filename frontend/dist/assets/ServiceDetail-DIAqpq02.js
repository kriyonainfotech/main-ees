import{r as o,F as R,j as t,a as v,B as d,U as F,b as $}from"./index-g8GziE3t.js";import{A as _}from"./AdminNavbar-BqDe4lKh.js";import{a as A,U as E}from"./UserSideBar-DC-s98j9.js";import{P as k}from"./ProfileSidebar-BIv84Ts5.js";import"./ess-121-DfLSNCpt.js";import"./index-CTpsVrPL.js";import"./index-DmNBRChd.js";const w="http://localhost:3000",L=({Usersdata:e,token:m})=>{var a,i,x,f,S,g,j;o.useContext(R);const[p,h]=o.useState(null),[y,r]=o.useState(!1),[q,l]=o.useState([]),b=(u,c=5)=>{const n=[];for(let s=1;s<=c;s++)n.push(t.jsx(A,{className:` ${s<=u?"text-warning":""}`,style:{cursor:"pointer"}},s));return n};o.useEffect(()=>{(async()=>{var c;r(!0);try{const n=await v.get(`${w}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}});if(n.status===200){l(n.data);const s=n.data.sendedRequests.find(C=>C.user._id===(e==null?void 0:e._id));h((s==null?void 0:s.status)||null)}}catch(n){console.error("Error fetching requests:",((c=n.response)==null?void 0:c.data)||n.message),d.error("Failed to load requests.")}finally{r(!1)}})()},[e,m]);const N=async u=>{var c;if((e==null?void 0:e.userstatus)==="unavailable"){d("User is unavailable");return}r(!0);try{(await v.post(`${w}/request/sentRequest`,{receiverId:u},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}})).status===200?(h("pending"),d("Request Sent Successfully!"),(await v.post(`${w}/auth/send`,{fcmToken:e==null?void 0:e.fcmToken,senderName:e==null?void 0:e.name,title:"New Request Received",message:`${e==null?void 0:e.name} has sent you a request.`},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`}})).status===200?console.log("FCM notification sent successfully!"):console.warn("Failed to send FCM notification.")):d.error("Failed to send request.")}catch(n){console.error("Error sending request:",((c=n.response)==null?void 0:c.data)||n.message),d.error("Failed to send request.")}finally{r(!1)}};return t.jsx("div",{className:"col-12 col-md-6 col-xl-3 p-2",style:{cursor:"pointer"},children:t.jsxs("div",{className:" border-0 overfloe-hidden  shadow-xl",children:[t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("figure",{className:"rounded-md h-[100px] w-[100px] overflow-hidden  m-3",children:t.jsx("img",{src:(e==null?void 0:e.profilePic)||"https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/User_icon_2.svg/220px-User_icon_2.svg.png",alt:"User Profile",className:"img-fluid overflow-hidden",style:{objectFit:"cover",objectPosition:"center"}})}),t.jsx("span",{className:`h-[20px] px-2 py-3 shadow-xl bg-white d-flex align-items-center rounded-5 text-capitalize text-sm p ${(e==null?void 0:e.userstatus)==="available"?"text-green":"text-orange"}`,children:e==null?void 0:e.userstatus})]}),t.jsxs("div",{className:"p-3 text-capitalize",children:[t.jsx("h2",{className:"font-bold",children:e==null?void 0:e.name}),t.jsx("h5",{className:"font-semibold py-1",children:e==null?void 0:e.businessCategory}),t.jsxs("p",{className:"text-muted text",children:[(a=e==null?void 0:e.address)==null?void 0:a.area," ",(i=e==null?void 0:e.address)==null?void 0:i.city," ",(x=e==null?void 0:e.address)==null?void 0:x.state," ",(f=e==null?void 0:e.address)==null?void 0:f.country," ",(S=e==null?void 0:e.address)==null?void 0:S.pincode]}),t.jsx("div",{className:"rating rating-sm py-2 d-flex align-items-center",children:e.ratings&&t.jsxs("div",{className:"d-flex align-items-center",children:[b((g=e==null?void 0:e.ratings[0])==null?void 0:g.rating,5),t.jsx("span",{className:"ps-2 ",children:(j=e.ratings[0])==null?void 0:j.rating})]})}),t.jsx("div",{children:p==="pending"?t.jsx("button",{className:"btn bg-orange text-white",onClick:()=>N(e==null?void 0:e._id),children:"Cancel Request"}):t.jsx("button",{className:"btn bg-green text-white",onClick:()=>N(e==null?void 0:e._id),disabled:y,children:y?"Sending...":"Send Request"})})]})]})})},P="http://localhost:3000",O=()=>{var a;const{user:e}=o.useContext(F),m=o.useMemo(()=>JSON.parse(localStorage.getItem("token")),[]),p=$(),[h,y]=o.useState(()=>localStorage.getItem("selectedCategory")||null),[r,q]=o.useState([]),[l,b]=o.useState(()=>e||JSON.parse(localStorage.getItem("loggedInUser"))||null),N=async(i,x)=>{try{const S=(await v.get(`${P}/auth/getAllUser`,{headers:{"Content-Type":"application/json"},withCredentials:!0})).data.user.filter(g=>{var j,u,c;return((j=g.businessCategory)==null?void 0:j.some(n=>n.toLowerCase()===(i==null?void 0:i.toLowerCase())))&&((c=(u=g.address)==null?void 0:u.city)==null?void 0:c.toLowerCase())===(x==null?void 0:x.toLowerCase())});q(S)}catch(f){console.error("Error fetching data:",f.message||f)}};return o.useEffect(()=>{p.state&&(y(p.state),localStorage.setItem("selectedCategory",p.state))},[p.state]),o.useEffect(()=>{var i;h&&((i=l==null?void 0:l.address)!=null&&i.city)&&N(h,l.address.city)},[h,(a=l==null?void 0:l.address)==null?void 0:a.city]),o.useEffect(()=>{e&&(b(e),localStorage.setItem("loggedInUser",JSON.stringify(e)))},[e]),t.jsxs(t.Fragment,{children:[t.jsx(_,{}),t.jsx(E,{}),t.jsx(k,{}),t.jsx("section",{className:"my-32",children:t.jsx("div",{className:"container",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"d-flex",children:t.jsx("h3",{className:"py-4 px-3",children:"Services Detail"})}),t.jsx("div",{className:"col-12 d-flex flex-wrap",children:r.length>0?r.map(i=>t.jsx(L,{Usersdata:i,token:m},i.id)):t.jsx("h4",{children:"No item Found"})})]})})})]})};export{O as default};
